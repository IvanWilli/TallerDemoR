<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 ggplot | Taller de R aplicado a la Demografía</title>
  <meta name="description" content="4 ggplot | Taller de R aplicado a la Demografía" />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="4 ggplot | Taller de R aplicado a la Demografía" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="IvanWilli/TallerDemoR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 ggplot | Taller de R aplicado a la Demografía" />
  
  
  

<meta name="author" content="Ayelén Martinez, Florencia Bathory e Iván Williams" />


<meta name="date" content="2023-12-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dplyr.html"/>
<link rel="next" href="funciones.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Taller de R aplicado a la demografía</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introducción</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#información-general"><i class="fa fa-check"></i><b>1.1</b> Información general</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#preparándonos"><i class="fa fa-check"></i><b>1.2</b> PrepaRándonos</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#instalación-de-y-rstudio"><i class="fa fa-check"></i><b>1.2.1</b> Instalación de y RStudio</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#instalación-de-paquetes"><i class="fa fa-check"></i><b>1.2.2</b> Instalación de paquetes</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#foro"><i class="fa fa-check"></i><b>1.2.3</b> Foro</a></li>
<li class="chapter" data-level="1.2.4" data-path="index.html"><a href="index.html#por-último"><i class="fa fa-check"></i><b>1.2.4</b> Por último</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#presentación-inicial"><i class="fa fa-check"></i><b>1.3</b> Presentación inicial</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> R Base</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#el-proyecto-taller"><i class="fa fa-check"></i><b>2.1</b> El proyecto Taller</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="intro.html"><a href="intro.html#variables"><i class="fa fa-check"></i><b>2.1.1</b> Variables</a></li>
<li class="chapter" data-level="2.1.2" data-path="intro.html"><a href="intro.html#actividad"><i class="fa fa-check"></i><b>2.1.2</b> Actividad</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#vectores"><i class="fa fa-check"></i><b>2.2</b> Vectores</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#actividad-1"><i class="fa fa-check"></i><b>2.2.1</b> Actividad</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#data.frames"><i class="fa fa-check"></i><b>2.3</b> Data.frames</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="intro.html"><a href="intro.html#actividad-2"><i class="fa fa-check"></i><b>2.3.1</b> Actividad</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#listas"><i class="fa fa-check"></i><b>2.4</b> Listas</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="intro.html"><a href="intro.html#actividad-3"><i class="fa fa-check"></i><b>2.4.1</b> Actividad</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#referencias-y-materiales-adicionales"><i class="fa fa-check"></i><b>2.5</b> Referencias y materiales adicionales</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>3</b> dplyr</a>
<ul>
<li class="chapter" data-level="3.1" data-path="dplyr.html"><a href="dplyr.html#lectura-de-datos"><i class="fa fa-check"></i><b>3.1</b> Lectura de datos</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="dplyr.html"><a href="dplyr.html#acceso-a-archivos-no-locales"><i class="fa fa-check"></i><b>3.1.1</b> Acceso a archivos no locales</a></li>
<li class="chapter" data-level="3.1.2" data-path="dplyr.html"><a href="dplyr.html#actividad-4"><i class="fa fa-check"></i><b>3.1.2</b> Actividad</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="dplyr.html"><a href="dplyr.html#dplyr-1"><i class="fa fa-check"></i><b>3.2</b> dplyr</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="dplyr.html"><a href="dplyr.html#seleccionar-select-renombrar-rename"><i class="fa fa-check"></i><b>3.2.1</b> seleccionar (<strong>select</strong>), renombrar (<strong>rename</strong>)</a></li>
<li class="chapter" data-level="3.2.2" data-path="dplyr.html"><a href="dplyr.html#actividad-5"><i class="fa fa-check"></i><b>3.2.2</b> Actividad</a></li>
<li class="chapter" data-level="3.2.3" data-path="dplyr.html"><a href="dplyr.html#resumir-summarise-por-grupos-group_by"><i class="fa fa-check"></i><b>3.2.3</b> resumir (<strong>summarise</strong>) por grupos (<strong>group_by</strong>)</a></li>
<li class="chapter" data-level="3.2.4" data-path="dplyr.html"><a href="dplyr.html#transformar-mutate-filtrar-filter-ordenar-arrange"><i class="fa fa-check"></i><b>3.2.4</b> transformar (<strong>mutate</strong>), filtrar (<strong>filter</strong>), ordenar (<strong>arrange</strong>)</a></li>
<li class="chapter" data-level="3.2.5" data-path="dplyr.html"><a href="dplyr.html#actividad-6"><i class="fa fa-check"></i><b>3.2.5</b> Actividad</a></li>
<li class="chapter" data-level="3.2.6" data-path="dplyr.html"><a href="dplyr.html#recursos-adicionales"><i class="fa fa-check"></i><b>3.2.6</b> Recursos adicionales</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>4</b> ggplot</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ggplot.html"><a href="ggplot.html#introducción-1"><i class="fa fa-check"></i><b>4.1</b> Introducción</a></li>
<li class="chapter" data-level="4.2" data-path="ggplot.html"><a href="ggplot.html#ggplot-1"><i class="fa fa-check"></i><b>4.2</b> ggplot</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="ggplot.html"><a href="ggplot.html#actividad-7"><i class="fa fa-check"></i><b>4.2.1</b> Actividad</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ggplot.html"><a href="ggplot.html#lexis"><i class="fa fa-check"></i><b>4.3</b> Lexis</a></li>
<li class="chapter" data-level="4.4" data-path="ggplot.html"><a href="ggplot.html#estudio-de-cohorte-un-ejemplo"><i class="fa fa-check"></i><b>4.4</b> Estudio de cohorte: un ejemplo</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="ggplot.html"><a href="ggplot.html#actividad-8"><i class="fa fa-check"></i><b>4.4.1</b> Actividad</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="ggplot.html"><a href="ggplot.html#reproduciendo"><i class="fa fa-check"></i><b>4.5</b> Reproduciendo</a></li>
<li class="chapter" data-level="4.6" data-path="ggplot.html"><a href="ggplot.html#otras-visualizaciones"><i class="fa fa-check"></i><b>4.6</b> Otras visualizaciones</a></li>
<li class="chapter" data-level="4.7" data-path="ggplot.html"><a href="ggplot.html#material-adicional-y-no-tanto"><i class="fa fa-check"></i><b>4.7</b> Material adicional (y no tanto)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="funciones.html"><a href="funciones.html"><i class="fa fa-check"></i><b>5</b> Funciones</a>
<ul>
<li class="chapter" data-level="5.1" data-path="funciones.html"><a href="funciones.html#demografía"><i class="fa fa-check"></i><b>5.1</b> DemogRafía</a></li>
<li class="chapter" data-level="5.2" data-path="funciones.html"><a href="funciones.html#funciones-1"><i class="fa fa-check"></i><b>5.2</b> Funciones</a></li>
<li class="chapter" data-level="5.3" data-path="funciones.html"><a href="funciones.html#crecimiento"><i class="fa fa-check"></i><b>5.3</b> Crecimiento</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="funciones.html"><a href="funciones.html#actividad-9"><i class="fa fa-check"></i><b>5.3.1</b> Actividad</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="funciones.html"><a href="funciones.html#estandarizando"><i class="fa fa-check"></i><b>5.4</b> Estandarizando</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="funciones.html"><a href="funciones.html#actividades"><i class="fa fa-check"></i><b>5.4.1</b> Actividades</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="funciones.html"><a href="funciones.html#funciones-demográficas-en-paquetes-demográficos"><i class="fa fa-check"></i><b>5.5</b> Funciones demográficas en paquetes demográficos</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="funciones.html"><a href="funciones.html#tablas-de-mortalidad"><i class="fa fa-check"></i><b>5.5.1</b> Tablas de mortalidad</a></li>
<li class="chapter" data-level="5.5.2" data-path="funciones.html"><a href="funciones.html#evaluación-de-declaración-de-edad"><i class="fa fa-check"></i><b>5.5.2</b> Evaluación de declaración de edad</a></li>
<li class="chapter" data-level="5.5.3" data-path="funciones.html"><a href="funciones.html#graduación-de-población-por-edad-simple"><i class="fa fa-check"></i><b>5.5.3</b> Graduación de población por edad simple</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><p>Taller de R aplicado a la Demografía</p></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> ggplot<a href="ggplot.html#ggplot" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introducción-1" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Introducción<a href="ggplot.html#introducción-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>En esta sección vamos a explorar la utilidad de R para la visualización de contenido demográfico. En <a href="https://www.demographic-research.org/volumes/vol44/36/default.htm">Riffe y otros (2021)</a> se publicó una colección de artículos sobre ejemplos de “buena” visualización en este tema. Allí reseña un poco de la historia (ver los gráficos de Perozzo <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm176.4-80a32 32 0 1 1 0 64 32 32 0 1 1 0-64zm128 32a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM256 288a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>) y se concluye con algunas recomendaciones a la hora de pensar cómo mostrar lo que queremos comunicar. Es interesante la distinción entre gráfico <strong>exploratorio</strong> y gráfico <strong>explicativo</strong>.</p>
<p>En la unidad previa trabajamos con una muestra censal a nivel de registro. Aquí contaremos con una distribución por edad y sexo de la población censada en los dos últimos censos e iremos recorriendo distintas formas de visualizar su contenido. Tenemos un <strong>objetivo</strong>:</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-2"></span>
<img src="figs/walk_piramyd.jpg" alt="https://fineartamerica.com/featured/walking-up-the-pyramid-kirt-tisdale.html?product=shower-curtain" width="60%" />
<p class="caption">
Figure 4.1: <a href="https://fineartamerica.com/featured/walking-up-the-pyramid-kirt-tisdale.html?product=shower-curtain" class="uri">https://fineartamerica.com/featured/walking-up-the-pyramid-kirt-tisdale.html?product=shower-curtain</a>
</p>
</div>
</div>
<div id="ggplot-1" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> ggplot<a href="ggplot.html#ggplot-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>El paquete <a href="https://ggplot2.tidyverse.org/">ggplot</a> del entorno <em>tidyverse</em> tiene sus fundamentos en la gramática de gráficos (<a href="https://link.springer.com/book/10.1007/0-387-28695-0">Wilkinson, 2005</a>), entender que todo plot es una composición de elementos, más allá de su especificidad (dispersión de putnos, línea, torta, etc.). La idea es “generalizar” su construcción tal que un paquete no sea una colección de <em>casos especiales</em>, sino una forma particular de combinar elementos (capas). Ya lleva 10 años!</p>
<p>Todo gráfico esta compuesto, jearárquicamente, por:</p>
<ul>
<li><strong>Datos</strong>: lo que contiene (en un formato determinado) aquello que queremos visualizar. Se utilza el argumento <code>data</code>.
<ul>
<li><em>Capas</em>
<ul>
<li><strong>Estética</strong> determinada: ¿quién es “x”?, ¿quién es “y”?, tamaño (<code>size</code>), color (<code>color</code>) y forma (<code>shape</code>), entre otros. Para esto se utiliza la función <code>aes</code> (de <em>aestethics</em> en ingles), y permite <em>mapear</em> las columnas de la data a cada argumento.</li>
<li>Expresión <strong>geométrica</strong> de los datos. Las más comunes son:
<ul>
<li>Puntos (<code>geom_point</code>)<br />
</li>
<li>Líneas (<code>geom_line</code>)<br />
</li>
<li>Barras (<code>geom_bar</code>)</li>
</ul></li>
</ul></li>
<li><em>Transformación</em> estadística (ajustar una regresión lineal, segmentar por percentiles, frecuencia de barra, etc.)</li>
</ul></li>
<li><strong>Sistema de coordenas</strong> y <strong>Escalas</strong>: las medidas relativas con las cuales interpretar los datos y su transformación visual. Personalización de ejes y leyenda, cambiar a escala logarítmica, asignar una escala de colores, etc.</li>
</ul>
<p>Obtengamos la población censal por provincia de los dos últimos censos, disponible en el archivo “PoblCensal01y10.xlsx”. Seleccionemos CABA y veamos su distribución por edad en 2010 con <strong>ggplot</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="ggplot.html#cb1-1" tabindex="-1"></a>N_CABA <span class="ot">&lt;-</span> N_Censo <span class="sc">%&gt;%</span> </span>
<span id="cb1-2"><a href="ggplot.html#cb1-2" tabindex="-1"></a>  <span class="fu">filter</span>(PROV_NOMBRE <span class="sc">==</span> <span class="st">&quot;CIUDAD AUTONOMA DE BUENOS AIRES&quot;</span> <span class="sc">&amp;</span> CENSO<span class="sc">==</span><span class="dv">2010</span>)</span>
<span id="cb1-3"><a href="ggplot.html#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="ggplot.html#cb1-4" tabindex="-1"></a><span class="co"># genero un primer gráfico con los tres elementos básicos:</span></span>
<span id="cb1-5"><a href="ggplot.html#cb1-5" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> N_CABA,                 <span class="co"># data</span></span>
<span id="cb1-6"><a href="ggplot.html#cb1-6" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> EDAD, <span class="at">y =</span> VARON)) <span class="sc">+</span>    <span class="co"># estética</span></span>
<span id="cb1-7"><a href="ggplot.html#cb1-7" tabindex="-1"></a>       <span class="fu">geom_line</span>()                    <span class="co"># geometría</span></span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Lo bueno de <code>&gt;%&gt;</code> es que puedo verbalizar también aquí!</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="ggplot.html#cb2-1" tabindex="-1"></a>N_CABA <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="ggplot.html#cb2-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> EDAD, <span class="at">y =</span> VARON)) <span class="sc">+</span> </span>
<span id="cb2-3"><a href="ggplot.html#cb2-3" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<div class="take_note_box take_note">
<p><code>ggplot</code> utiliza <code>+</code> en vez de <code>%&gt;%</code>. No es algo de lo que esté orgulloso su creador, pero tiene sus <a href="https://community.rstudio.com/t/why-cant-ggplot2-use/4372">razones</a>.</p>
</div>
<p>Podemos compararla con otras provincias en 2010, como Formosa y Entre Ríos, distinguiéndolas por color (<em>estética</em>). Tomemos el caso de los varones. ¿Qué observaciones podemos hacer?</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="ggplot.html#cb3-1" tabindex="-1"></a><span class="co"># creo un vector con las seleccionadas, y filtro la base</span></span>
<span id="cb3-2"><a href="ggplot.html#cb3-2" tabindex="-1"></a>Provincias <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;FORMOSA&quot;</span>, <span class="st">&quot;ENTRE RIOS&quot;</span>, <span class="st">&quot;CIUDAD AUTONOMA DE BUENOS AIRES&quot;</span>)</span>
<span id="cb3-3"><a href="ggplot.html#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="ggplot.html#cb3-4" tabindex="-1"></a><span class="co"># filtro data</span></span>
<span id="cb3-5"><a href="ggplot.html#cb3-5" tabindex="-1"></a>N_Provs <span class="ot">&lt;-</span> N_Censo <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="ggplot.html#cb3-6" tabindex="-1"></a>  <span class="fu">filter</span>(PROV_NOMBRE <span class="sc">%in%</span> Provincias, CENSO<span class="sc">==</span><span class="dv">2010</span>)</span>
<span id="cb3-7"><a href="ggplot.html#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="ggplot.html#cb3-8" tabindex="-1"></a><span class="co"># genero un primer gráfico con los tres elementos básicos:</span></span>
<span id="cb3-9"><a href="ggplot.html#cb3-9" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> N_Provs,                                       <span class="co"># data</span></span>
<span id="cb3-10"><a href="ggplot.html#cb3-10" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> EDAD, <span class="at">y =</span> VARON, <span class="at">color =</span> PROV_NOMBRE)) <span class="sc">+</span>      <span class="co"># estética</span></span>
<span id="cb3-11"><a href="ggplot.html#cb3-11" tabindex="-1"></a>       <span class="fu">geom_line</span>()                                           <span class="co"># geometría</span></span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Podemos adicionar otra capa geométrica de puntos distinguiendo por <em>forma</em> (atributo estético adicional). Ya estamos en 4 dimensiones.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="ggplot.html#cb4-1" tabindex="-1"></a>g_Provs <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> N_Provs, </span>
<span id="cb4-2"><a href="ggplot.html#cb4-2" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x=</span> EDAD, <span class="at">y =</span> MUJER, <span class="at">color =</span> PROV_NOMBRE)) <span class="sc">+</span> </span>
<span id="cb4-3"><a href="ggplot.html#cb4-3" tabindex="-1"></a>           <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb4-4"><a href="ggplot.html#cb4-4" tabindex="-1"></a>           <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> PROV_NOMBRE))</span></code></pre></div>
<p>Acabamos de crear un objeto: ¿de qué tipo es?.</p>
<div class="take_note_box take_note">
<p>Lo que se encuentra dentro de <code>ggplot()</code> vale para todas las capas, excepto se “pise”. Por ejemplo, da el mismo plot las siguientes dos sentencias:
<code>data %&gt;% ggplot(aes(x= EDAD, y = MUJER) + geom_line()</code>
que…
<code>data %&gt;% ggplot() + geom_line(aes(x= EDAD, y = MUJER))</code></p>
</div>
<p>Agreguemos <a href="https://ggplot2.tidyverse.org/reference/labs.html">un título, un subtítulo</a>, modifiquemos el tamaño del punto, la posición y título de la leyenda, y especifiquemos las marcas en el eje x:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="ggplot.html#cb5-1" tabindex="-1"></a>g_Provs <span class="ot">&lt;-</span> g_Provs <span class="sc">+</span>  <span class="co"># partimos del objeto anterior</span></span>
<span id="cb5-2"><a href="ggplot.html#cb5-2" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Población de varones por edad. Año 2010&quot;</span>,</span>
<span id="cb5-3"><a href="ggplot.html#cb5-3" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Provincias seleccionadas&quot;</span>,</span>
<span id="cb5-4"><a href="ggplot.html#cb5-4" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Fuente: INDEC&quot;</span>,</span>
<span id="cb5-5"><a href="ggplot.html#cb5-5" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Edad&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Varones&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-6"><a href="ggplot.html#cb5-6" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, </span>
<span id="cb5-7"><a href="ggplot.html#cb5-7" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb5-8"><a href="ggplot.html#cb5-8" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb5-9"><a href="ggplot.html#cb5-9" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">10</span>)) <span class="co"># ups!</span></span>
<span id="cb5-10"><a href="ggplot.html#cb5-10" tabindex="-1"></a>g_Provs</span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Podemos definir una paleta de colores, cambiar la <a href="https://ggplot2.tidyverse.org/reference/theme.html">temática</a> de fondo por una más simple y suavizar las series con algún modelo. Adicionalmente mediante <a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a> podemos guardar el objeto como imágen en la extensión que se desee.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="ggplot.html#cb6-1" tabindex="-1"></a>mi_paleta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#000000&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>) <span class="co"># sistema Hexadecimal de colores</span></span>
<span id="cb6-2"><a href="ggplot.html#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="ggplot.html#cb6-3" tabindex="-1"></a>g_Provs <span class="ot">&lt;-</span> g_Provs <span class="sc">+</span></span>
<span id="cb6-4"><a href="ggplot.html#cb6-4" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mi_paleta) <span class="sc">+</span></span>
<span id="cb6-5"><a href="ggplot.html#cb6-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb6-6"><a href="ggplot.html#cb6-6" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;loess&#39;</span>, <span class="at">span=</span>.<span class="dv">5</span>) <span class="co"># podés jugar con span (0,1)</span></span>
<span id="cb6-7"><a href="ggplot.html#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="ggplot.html#cb6-8" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;g_Provs.pdf&quot;</span>, <span class="at">plot =</span> g_Provs)</span></code></pre></div>
<pre><code>## Saving 7 x 5 in image
## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="ggplot.html#cb8-1" tabindex="-1"></a>g_Provs</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="talleR_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Podés encontrar <a href="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/">más colores y paletas prediseñadas</a>, temáticas <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">predefinidas</a> o incluidas en paquetes como <a href="https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/">ggthemes</a>, y formas de suavizar una serie continua (aquí utilizamos <code>loess</code>, por defecto, pero puede ser <code>lm</code>, de linear model).</p>
<p>Para continuar nuestro camino hacia la pirámide de población con <code>ggplot</code>, conviene que <code>Sexo</code> sea una única variable con dos categorías (una variable de tipo <em>factor</em>). Una buena idea: siempre tratar con <strong>tidy</strong> data!</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-10"></span>
<img src="figs/tidydata.jpg" alt="https://github.com/allisonhorst/stats-illustrations" width="100%" />
<p class="caption">
Figure 4.2: <a href="https://github.com/allisonhorst/stats-illustrations" class="uri">https://github.com/allisonhorst/stats-illustrations</a>
</p>
</div>
<p>Postulados:</p>
<ul>
<li><p>Cada <em>columna</em> es una variable.</p></li>
<li><p>Cada <em>fila</em> es una realización/observación de la unidad de análisis.</p></li>
<li><p>Cada <em>celda</em> es un valor observado, un dato.</p></li>
</ul>
<p>Para esto utlizaremos las funciones <code>pivot</code> (antiguamaente llamadas <em>gather</em> y <em>spread</em>, por si lo ves en la web). Leamos la hoja de ayuda (<em>cheat sheet</em>) de <a href="https://tidyr.tidyverse.org/">tidyr</a> juntos, otro paquete del entorno <code>tidyverse</code>. Y quedémonos por el momento con Entre Ríos.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="ggplot.html#cb10-1" tabindex="-1"></a>N_ER <span class="ot">&lt;-</span> N_Provs <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="ggplot.html#cb10-2" tabindex="-1"></a>              <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(VARON, MUJER), <span class="at">names_to =</span> <span class="st">&quot;Sexo&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;N&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="ggplot.html#cb10-3" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">Sexo =</span> <span class="fu">as.factor</span>(Sexo)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="ggplot.html#cb10-4" tabindex="-1"></a>              <span class="fu">filter</span>(PROV_NOMBRE <span class="sc">==</span> <span class="st">&quot;ENTRE RIOS&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="ggplot.html#cb10-5" tabindex="-1"></a>              <span class="fu">select</span>(<span class="sc">-</span>PROV_CODIGO) <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="ggplot.html#cb10-6" tabindex="-1"></a>  <span class="fu">arrange</span>(CENSO, Sexo, EDAD)</span>
<span id="cb10-7"><a href="ggplot.html#cb10-7" tabindex="-1"></a><span class="fu">head</span>(N_ER)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   CENSO PROV_NOMBRE  EDAD Sexo      N
##   &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;
## 1  2010 ENTRE RIOS      0 MUJER  9843
## 2  2010 ENTRE RIOS      1 MUJER  9856
## 3  2010 ENTRE RIOS      2 MUJER  9937
## 4  2010 ENTRE RIOS      3 MUJER  9562
## 5  2010 ENTRE RIOS      4 MUJER  9824
## 6  2010 ENTRE RIOS      5 MUJER 10396</code></pre>
<p>Tenemos nuestra tabla preparada, es el momento de pasar a una geometría de barras. Al momento de trabajar con <em>barras</em>, la estética <code>fill</code> equivale al atributo <code>color</code> de líneas o puntos. Podemos incluir el condicional de signo dentro de la definición de ejes (o de manera previa mediante <code>mutate</code>, como prefieras):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="ggplot.html#cb12-1" tabindex="-1"></a>Pir_ER <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> N_ER, </span>
<span id="cb12-2"><a href="ggplot.html#cb12-2" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">x =</span> EDAD, <span class="at">y =</span> <span class="fu">ifelse</span>(Sexo <span class="sc">==</span> <span class="st">&quot;VARON&quot;</span>, <span class="sc">-</span>N, N), <span class="at">fill =</span> Sexo)) <span class="sc">+</span></span>
<span id="cb12-3"><a href="ggplot.html#cb12-3" tabindex="-1"></a>                <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="co"># que ggplot no trate de contar cual histograma</span></span>
<span id="cb12-4"><a href="ggplot.html#cb12-4" tabindex="-1"></a>Pir_ER</span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Ups! Hay que dar vuelta (<em>flip</em>) la pirámide. Podemos hacerle unos cambios adicionales de paso: fijar los límites horizontales y mostrar solo absolutos, incluir titulo, subtítulo y fuente, cambiar las etiquetas de ambos ejes, incluir un <em>tema</em> distinto y cambiar el color de las barras.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="ggplot.html#cb13-1" tabindex="-1"></a>Pir_ER <span class="ot">&lt;-</span> Pir_ER <span class="sc">+</span></span>
<span id="cb13-2"><a href="ggplot.html#cb13-2" tabindex="-1"></a>            <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb13-3"><a href="ggplot.html#cb13-3" tabindex="-1"></a>            <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> abs, <span class="at">limits =</span> <span class="fu">max</span>(N_ER<span class="sc">$</span>N) <span class="sc">*</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb13-4"><a href="ggplot.html#cb13-4" tabindex="-1"></a>            <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">110</span>,<span class="dv">5</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">110</span>,<span class="dv">5</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">110</span>)) <span class="sc">+</span></span>
<span id="cb13-5"><a href="ggplot.html#cb13-5" tabindex="-1"></a>            <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Población&quot;</span>, </span>
<span id="cb13-6"><a href="ggplot.html#cb13-6" tabindex="-1"></a>                 <span class="at">x =</span> <span class="st">&quot;Edad&quot;</span>,</span>
<span id="cb13-7"><a href="ggplot.html#cb13-7" tabindex="-1"></a>                 <span class="at">title =</span> <span class="st">&quot;Pirámide de población. Año 2010&quot;</span>,</span>
<span id="cb13-8"><a href="ggplot.html#cb13-8" tabindex="-1"></a>                 <span class="at">subtitle =</span> <span class="st">&quot;Entre Ríos&quot;</span>,</span>
<span id="cb13-9"><a href="ggplot.html#cb13-9" tabindex="-1"></a>                 <span class="at">caption =</span> <span class="st">&quot;Fuente: en base a INDEC&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-10"><a href="ggplot.html#cb13-10" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>)) <span class="sc">+</span></span>
<span id="cb13-11"><a href="ggplot.html#cb13-11" tabindex="-1"></a>            <span class="fu">theme_bw</span>()</span>
<span id="cb13-12"><a href="ggplot.html#cb13-12" tabindex="-1"></a>Pir_ER  </span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Probablemente querramos comparar provincias, para lo que podemos usar las opciones de <a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">faceting</a>. Volvamos a utilizar el <code>data.frame</code> de 3 provincias, transformándolo primero a formato <em>tidy</em>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="ggplot.html#cb14-1" tabindex="-1"></a><span class="co"># formato tidy</span></span>
<span id="cb14-2"><a href="ggplot.html#cb14-2" tabindex="-1"></a>N_Provs <span class="ot">&lt;-</span> N_Provs <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="ggplot.html#cb14-3" tabindex="-1"></a>              <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(VARON, MUJER), <span class="at">names_to =</span> <span class="st">&quot;Sexo&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;N&quot;</span>) </span>
<span id="cb14-4"><a href="ggplot.html#cb14-4" tabindex="-1"></a>          </span>
<span id="cb14-5"><a href="ggplot.html#cb14-5" tabindex="-1"></a><span class="co"># pirámide     </span></span>
<span id="cb14-6"><a href="ggplot.html#cb14-6" tabindex="-1"></a>Pirs <span class="ot">&lt;-</span> N_Provs <span class="sc">%&gt;%</span> </span>
<span id="cb14-7"><a href="ggplot.html#cb14-7" tabindex="-1"></a>                <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> EDAD, <span class="at">y =</span> <span class="fu">ifelse</span>(Sexo <span class="sc">==</span> <span class="st">&quot;VARON&quot;</span>, <span class="sc">-</span>N, N), <span class="at">fill =</span> Sexo)) <span class="sc">+</span></span>
<span id="cb14-8"><a href="ggplot.html#cb14-8" tabindex="-1"></a>                <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-9"><a href="ggplot.html#cb14-9" tabindex="-1"></a>                <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb14-10"><a href="ggplot.html#cb14-10" tabindex="-1"></a>                <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> abs,</span>
<span id="cb14-11"><a href="ggplot.html#cb14-11" tabindex="-1"></a>                                   <span class="at">limits =</span> <span class="fu">max</span>(N_Provs<span class="sc">$</span>N) <span class="sc">*</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb14-12"><a href="ggplot.html#cb14-12" tabindex="-1"></a>                <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Población&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Edad&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-13"><a href="ggplot.html#cb14-13" tabindex="-1"></a>                <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Pirámide de población. Año 2010&quot;</span>,</span>
<span id="cb14-14"><a href="ggplot.html#cb14-14" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">&quot;Provincias seleccionadas&quot;</span>,</span>
<span id="cb14-15"><a href="ggplot.html#cb14-15" tabindex="-1"></a>                  <span class="at">caption =</span> <span class="st">&quot;Fuente: INDEC&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-16"><a href="ggplot.html#cb14-16" tabindex="-1"></a>                <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>)) <span class="sc">+</span></span>
<span id="cb14-17"><a href="ggplot.html#cb14-17" tabindex="-1"></a>                <span class="fu">theme_dark</span>() <span class="sc">+</span></span>
<span id="cb14-18"><a href="ggplot.html#cb14-18" tabindex="-1"></a>                <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(PROV_NOMBRE)) <span class="co"># o cols?</span></span>
<span id="cb14-19"><a href="ggplot.html#cb14-19" tabindex="-1"></a>Pirs</span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Utilicé dos veces <code>labs</code>! Es posible porque <code>ggplot</code> funciona sumando elementos. ¿El gráfico nos permite inferir estadíos transicionales? Mmm… Deberíamos verlo en porcentajes. Todo en una sentencia:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="ggplot.html#cb15-1" tabindex="-1"></a>PirsPorc <span class="ot">&lt;-</span> N_Provs <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="ggplot.html#cb15-2" tabindex="-1"></a>                <span class="fu">group_by</span>(PROV_NOMBRE, Sexo) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="ggplot.html#cb15-3" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">Np =</span> <span class="fu">round</span>(N<span class="sc">/</span><span class="fu">sum</span>(N)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="ggplot.html#cb15-4" tabindex="-1"></a>                <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb15-5"><a href="ggplot.html#cb15-5" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> EDAD, <span class="at">y =</span> <span class="fu">ifelse</span>(Sexo <span class="sc">==</span> <span class="st">&quot;VARON&quot;</span>, <span class="sc">-</span>Np, Np), <span class="at">fill =</span> Sexo) <span class="sc">+</span></span>
<span id="cb15-6"><a href="ggplot.html#cb15-6" tabindex="-1"></a>                  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-7"><a href="ggplot.html#cb15-7" tabindex="-1"></a>                  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb15-8"><a href="ggplot.html#cb15-8" tabindex="-1"></a>                  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> abs) <span class="sc">+</span></span>
<span id="cb15-9"><a href="ggplot.html#cb15-9" tabindex="-1"></a>                  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Porcentaje de población&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Edad&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-10"><a href="ggplot.html#cb15-10" tabindex="-1"></a>                  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb15-11"><a href="ggplot.html#cb15-11" tabindex="-1"></a>                  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span><span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;gold&quot;</span>))<span class="sc">+</span></span>
<span id="cb15-12"><a href="ggplot.html#cb15-12" tabindex="-1"></a>                  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(PROV_NOMBRE))</span>
<span id="cb15-13"><a href="ggplot.html#cb15-13" tabindex="-1"></a>PirsPorc</span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Finalmente, cuando necesites guardar el gráfico, por ejemplo como pdf:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="ggplot.html#cb16-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> <span class="st">&quot;PirsPorc.pdf&quot;</span>, <span class="at">filename =</span> PirsPorc)</span></code></pre></div>
<p>¡Ahora sí! Estamos en condiciones de percibir visualmente qué nos dice el stock por edad y sexo: envejecimiento, efecto migratorio, patrones de declaración censal de edad. ¿Qué más? Quizás si fuera un gráfico interactivo… Un bonus track utilzando <a href="https://plot.ly/ggplot2/">plotly</a>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="ggplot.html#cb17-1" tabindex="-1"></a><span class="co">#install.packages(&quot;plotly&quot;)</span></span>
<span id="cb17-2"><a href="ggplot.html#cb17-2" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;plotly&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     last_plot</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<pre><code>## The following object is masked from &#39;package:graphics&#39;:
## 
##     layout</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="ggplot.html#cb22-1" tabindex="-1"></a>PirsPorc_plotly <span class="ot">&lt;-</span> <span class="fu">ggplotly</span>(PirsPorc <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">text =</span> Np), <span class="at">tooltip=</span> <span class="st">&quot;text&quot;</span>) </span></code></pre></div>
<div id="actividad-7" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Actividad<a href="ggplot.html#actividad-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: lower-alpha">
<li><p>Realizar un gráfico de línea con el índice de masculinidad por edad de la provincia que prefiera para el censo 2010.</p></li>
<li><p>Ahora incluya ambos censos, cada uno con un color distinto.</p></li>
<li><p>Hacer el mismo gráfico pero comparando 3 provincias.</p></li>
<li><p>El primer autor te escribe para incluir el gráfico previo en una publicación. ¿Qué modificaciones le harías para dejarlo listo?</p></li>
<li><p>Construir la pirámide de población del Total país, colocando ambos censos uno debajo del otro.</p></li>
<li><p>Ahora el primer autor (incansable) te solicita que hagas el plot anterior pero por grupos quinquenales de edad.</p></li>
</ol>
</div>
</div>
<div id="lexis" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Lexis<a href="ggplot.html#lexis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Gráfico útil para representar la dinámica poblacional de <em>ingreso</em> y <em>permanencia</em> en un estadío demográfico según edad, tiempo calendario (o período) y año de nacimiento (o cohorte). Su aplicación más común es en mortalidad, pero es generalizable a la relación exposición~evento con múltiples <a href="https://apuntesdedemografia.com/curso-de-demografia/temario/tema-2-generalidades/el-diagrama-de-lexis/">usos</a>.<br />
<img src="figs/LexisPreston.png" width="500" alt="Fuente: Preston et. al (2001)" /></p>
<p>Los elementos principales de análisis son:</p>
<ul>
<li>Líneas de vida (45°)<br />
</li>
<li>Segmentos horizontales y verticales<br />
</li>
<li>Superficies</li>
</ul>
<p><img src="figs/LexisElements.png" /></p>
<p>Ejemplos de uso del diagrama utilizando R:</p>
<ul>
<li><p>Mortalidad por conflictos armados (replicable):
<img src="figs/AlburezLexis.jpg" alt="Fuente: Alburez et. al (2019)" />
Fuente: Alburez et. al (2019)</p></li>
<li><p>Sobremortalidad masculina en Inglaterra y Gales (1841-2013):
<img src="figs/LexisMortalityMF.png" alt="Fuente: Schöley &amp; Willekens (2017)" />
Fuente: Schöley &amp; Willekens (2017)</p></li>
</ul>
<p>Construyamos el diagrama básico del inicio. Para eso haremos uso del paquete <a href="https://github.com/ottlngr/LexisPlotR">LexisPlotR</a> creado por Philipp Ottolinger (gracias Otto). Construyó un set de funciones basadas en <em>ggplot</em> que facilita la creación de diagramas haciéndolo un ejercicio intuitivo.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="ggplot.html#cb23-1" tabindex="-1"></a><span class="co"># install.packages(&quot;devtools&quot;)</span></span>
<span id="cb23-2"><a href="ggplot.html#cb23-2" tabindex="-1"></a><span class="co"># devtools::install_github(&quot;ottlngr/LexisPlotR&quot;) #¿Cómo no esta en CRAN?</span></span>
<span id="cb23-3"><a href="ggplot.html#cb23-3" tabindex="-1"></a><span class="fu">library</span>(LexisPlotR)</span>
<span id="cb23-4"><a href="ggplot.html#cb23-4" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb23-5"><a href="ggplot.html#cb23-5" tabindex="-1"></a></span>
<span id="cb23-6"><a href="ggplot.html#cb23-6" tabindex="-1"></a><span class="co"># creamos el objeto &quot;mylexis&quot;, definiendo el rango de sus ejes: los primeros 10 años de vida durante 2010-2019. Aquí podemos especificar un &quot;delta&quot; si es que nos interesan los grupos quinquenales.</span></span>
<span id="cb23-7"><a href="ggplot.html#cb23-7" tabindex="-1"></a>mylexis <span class="ot">&lt;-</span> <span class="fu">lexis_grid</span>(<span class="at">year_start =</span> <span class="dv">2010</span>, <span class="at">year_end =</span> <span class="dv">2019</span>, <span class="at">age_start =</span> <span class="dv">0</span>, <span class="at">age_end =</span> <span class="dv">10</span>)</span>
<span id="cb23-8"><a href="ggplot.html#cb23-8" tabindex="-1"></a></span>
<span id="cb23-9"><a href="ggplot.html#cb23-9" tabindex="-1"></a><span class="co"># pintamos la edad 2</span></span>
<span id="cb23-10"><a href="ggplot.html#cb23-10" tabindex="-1"></a>mylexis <span class="ot">&lt;-</span> <span class="fu">lexis_age</span>(<span class="at">lg =</span> mylexis, <span class="at">age =</span> <span class="dv">2</span>)</span>
<span id="cb23-11"><a href="ggplot.html#cb23-11" tabindex="-1"></a></span>
<span id="cb23-12"><a href="ggplot.html#cb23-12" tabindex="-1"></a><span class="co"># pintamos el año 2015, de gris en este caso.</span></span>
<span id="cb23-13"><a href="ggplot.html#cb23-13" tabindex="-1"></a>mylexis <span class="ot">&lt;-</span> <span class="fu">lexis_year</span>(<span class="at">lg =</span> mylexis, <span class="at">year =</span> <span class="dv">2015</span>, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb23-14"><a href="ggplot.html#cb23-14" tabindex="-1"></a></span>
<span id="cb23-15"><a href="ggplot.html#cb23-15" tabindex="-1"></a><span class="co"># Ahora la cohorte 2015</span></span>
<span id="cb23-16"><a href="ggplot.html#cb23-16" tabindex="-1"></a>mylexis <span class="ot">&lt;-</span> <span class="fu">lexis_cohort</span>(<span class="at">lg =</span> mylexis, <span class="at">cohort =</span> <span class="dv">2015</span>)</span>
<span id="cb23-17"><a href="ggplot.html#cb23-17" tabindex="-1"></a></span>
<span id="cb23-18"><a href="ggplot.html#cb23-18" tabindex="-1"></a><span class="co"># Una línea de vida, ¡elemento fundamental del diagrama!</span></span>
<span id="cb23-19"><a href="ggplot.html#cb23-19" tabindex="-1"></a>mylexis <span class="ot">&lt;-</span> <span class="fu">lexis_lifeline</span>(<span class="at">lg =</span> mylexis, <span class="at">birth =</span> <span class="st">&quot;2001-09-23&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;pink&quot;</span>)</span>
<span id="cb23-20"><a href="ggplot.html#cb23-20" tabindex="-1"></a></span>
<span id="cb23-21"><a href="ggplot.html#cb23-21" tabindex="-1"></a><span class="co"># Al ser un objeto ggplot, podemos incorporarle atributos, como el título</span></span>
<span id="cb23-22"><a href="ggplot.html#cb23-22" tabindex="-1"></a>mylexis <span class="ot">&lt;-</span> mylexis <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Año&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Edad&quot;</span>,<span class="at">title =</span> <span class="st">&quot;Diagrama de Lexis. Elementos de análisis&quot;</span>)</span>
<span id="cb23-23"><a href="ggplot.html#cb23-23" tabindex="-1"></a></span>
<span id="cb23-24"><a href="ggplot.html#cb23-24" tabindex="-1"></a><span class="co"># Para crear polígonos, el autor se basa en la geometría &quot;geom_polygon&quot;. Creamos un cuadrado. El orden de los datos es importante. Además podemos crear muchos polígonos al mismo tiempo señalando los grupos.</span></span>
<span id="cb23-25"><a href="ggplot.html#cb23-25" tabindex="-1"></a>square <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">group =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb23-26"><a href="ggplot.html#cb23-26" tabindex="-1"></a>                       <span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;2012-01-01&quot;</span>, <span class="st">&quot;2012-01-01&quot;</span>, <span class="st">&quot;2013-01-01&quot;</span>, <span class="st">&quot;2013-01-01&quot;</span>),</span>
<span id="cb23-27"><a href="ggplot.html#cb23-27" tabindex="-1"></a>                       <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">4</span>,             <span class="dv">5</span>,            <span class="dv">5</span>,            <span class="dv">4</span>))</span>
<span id="cb23-28"><a href="ggplot.html#cb23-28" tabindex="-1"></a>mylexis <span class="ot">&lt;-</span> <span class="fu">lexis_polygon</span>(<span class="at">lg =</span> mylexis, <span class="at">x =</span> square<span class="sc">$</span>x, <span class="at">y =</span> square<span class="sc">$</span>y, <span class="at">group =</span> square<span class="sc">$</span>group)</span>
<span id="cb23-29"><a href="ggplot.html#cb23-29" tabindex="-1"></a></span>
<span id="cb23-30"><a href="ggplot.html#cb23-30" tabindex="-1"></a><span class="co"># Creamos el triángulo. ¿A qué refiere?</span></span>
<span id="cb23-31"><a href="ggplot.html#cb23-31" tabindex="-1"></a>triangle <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">group =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb23-32"><a href="ggplot.html#cb23-32" tabindex="-1"></a>                       <span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;2017-01-01&quot;</span>, <span class="st">&quot;2018-01-01&quot;</span>, <span class="st">&quot;2018-01-01&quot;</span>),</span>
<span id="cb23-33"><a href="ggplot.html#cb23-33" tabindex="-1"></a>                       <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">7</span>))</span>
<span id="cb23-34"><a href="ggplot.html#cb23-34" tabindex="-1"></a>mylexis <span class="ot">&lt;-</span> <span class="fu">lexis_polygon</span>(<span class="at">lg =</span> mylexis, <span class="at">x =</span> triangle<span class="sc">$</span>x, <span class="at">y =</span> triangle<span class="sc">$</span>y, <span class="at">group =</span> triangle<span class="sc">$</span>group)</span>
<span id="cb23-35"><a href="ggplot.html#cb23-35" tabindex="-1"></a></span>
<span id="cb23-36"><a href="ggplot.html#cb23-36" tabindex="-1"></a><span class="co"># Imprimimos!</span></span>
<span id="cb23-37"><a href="ggplot.html#cb23-37" tabindex="-1"></a>mylexis</span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Adicionalmente, si trabajamos con población donde la exposición puede ser truncada (por derecha o izquierda), podemos graficar líneas de vida que respeten ese comportamiento. Tambien podemos señalar con una cruz la ocurrencia del evento de salida que se estudia.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="ggplot.html#cb24-1" tabindex="-1"></a><span class="co"># ingresa al estudio sobre deserción escolar en el año 2012 un niño/a nacido en el año 2005, abandonando el colegio a los 9 años de edad:</span></span>
<span id="cb24-2"><a href="ggplot.html#cb24-2" tabindex="-1"></a>mylexis <span class="ot">&lt;-</span> <span class="fu">lexis_lifeline</span>(<span class="at">lg =</span> mylexis, </span>
<span id="cb24-3"><a href="ggplot.html#cb24-3" tabindex="-1"></a>                          <span class="at">birth =</span> <span class="st">&quot;2005-09-23&quot;</span>, </span>
<span id="cb24-4"><a href="ggplot.html#cb24-4" tabindex="-1"></a>                          <span class="at">entry =</span> <span class="st">&quot;2012-06-11&quot;</span>, <span class="at">exit =</span> <span class="st">&quot;2015-02-27&quot;</span>, <span class="at">lineends =</span> T,</span>
<span id="cb24-5"><a href="ggplot.html#cb24-5" tabindex="-1"></a>                          <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb24-6"><a href="ggplot.html#cb24-6" tabindex="-1"></a>mylexis</span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Pero atrás de esto esta <code>ggplot</code>!</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="ggplot.html#cb25-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-2"><a href="ggplot.html#cb25-2" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">2011</span>, <span class="at">y =</span> <span class="dv">5</span>, <span class="at">xend =</span> <span class="dv">2015</span>, <span class="at">yend =</span> <span class="dv">9</span>), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span> <span class="co"># debería ir al final</span></span>
<span id="cb25-3"><a href="ggplot.html#cb25-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">2015</span>, <span class="at">y=</span><span class="dv">9</span>),<span class="at">shape=</span><span class="dv">4</span>,<span class="at">size=</span><span class="dv">2</span>,<span class="at">col=</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb25-4"><a href="ggplot.html#cb25-4" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb25-5"><a href="ggplot.html#cb25-5" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">2010</span><span class="sc">:</span><span class="dv">2020</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb25-6"><a href="ggplot.html#cb25-6" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb25-7"><a href="ggplot.html#cb25-7" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2010</span><span class="sc">:</span><span class="dv">2020</span>, <span class="at">color=</span><span class="st">&quot;grey&quot;</span>, <span class="at">size=</span>.<span class="dv">15</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb25-8"><a href="ggplot.html#cb25-8" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">color=</span><span class="st">&quot;grey&quot;</span>, <span class="at">size=</span>.<span class="dv">15</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb25-9"><a href="ggplot.html#cb25-9" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2020</span>, <span class="sc">-</span><span class="dv">2000</span>, <span class="at">by=</span><span class="dv">1</span>), <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color=</span><span class="st">&quot;grey&quot;</span>, <span class="at">size=</span>.<span class="dv">15</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb25-10"><a href="ggplot.html#cb25-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Año&quot;</span>, <span class="at">y=</span><span class="st">&quot;Edad&quot;</span>,<span class="at">title =</span> <span class="st">&quot;Dieagrama de Lexis c/ ggplot&quot;</span>)<span class="sc">+</span></span>
<span id="cb25-11"><a href="ggplot.html#cb25-11" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb25-12"><a href="ggplot.html#cb25-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb25-13"><a href="ggplot.html#cb25-13" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb25-14"><a href="ggplot.html#cb25-14" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, </span>
<span id="cb25-15"><a href="ggplot.html#cb25-15" tabindex="-1"></a>                                       <span class="at">colour =</span> <span class="st">&quot;transparent&quot;</span>))</span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Para incluir triángulos y cuadriláteros se utiliza <a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a>. Para dar superficie, de manera similar al gráfico Scholey &amp; Willekens (2017), se utiliza <a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a>. Para esto último un gran tutorial de <a href="https://timriffe.github.io/DemoTutorials/LexisSurface">Tim Riffe</a>.</p>
</div>
<div id="estudio-de-cohorte-un-ejemplo" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Estudio de cohorte: un ejemplo<a href="ggplot.html#estudio-de-cohorte-un-ejemplo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Construyamos una tabla de cohorte a partir de un grupo de estudiantes que iniciaron con 3 años de edad (cumplida) su trayectoria educativa el 3/3/2000, y donde la <em>salida</em> es dejar el estudio (sea cual sea el nivel alcanzado) por <strong>primera vez</strong> antes de retomar o abandonar definitivamente (¿en este contexto qué sería <span class="math inline">\(\omega\)</span>?). Simulemos el comportamiento de 1000 chicas/os con distribución <em>uniforme</em> de la edad y distribución <em>gamma</em> del tiempo de permanencia:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="ggplot.html#cb26-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>) <span class="co"># qué es esto?</span></span>
<span id="cb26-2"><a href="ggplot.html#cb26-2" tabindex="-1"></a>clase <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">edad_inicio =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">min =</span> <span class="dv">3</span>, <span class="at">max =</span> <span class="dv">4</span>),</span>
<span id="cb26-3"><a href="ggplot.html#cb26-3" tabindex="-1"></a>                    <span class="at">tiempo_exp =</span> <span class="fu">rgamma</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">shape =</span> <span class="dv">40</span>, <span class="at">rate =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="ggplot.html#cb26-4" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">edad_salida =</span> edad_inicio <span class="sc">+</span> tiempo_exp)</span></code></pre></div>
<p>¿Cómo luce?</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="ggplot.html#cb27-1" tabindex="-1"></a><span class="fu">ggplot</span>(clase, <span class="fu">aes</span>(<span class="at">x=</span>edad_salida)) <span class="sc">+</span> </span>
<span id="cb27-2"><a href="ggplot.html#cb27-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="dv">2</span>, <span class="at">alpha=</span>.<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb27-3"><a href="ggplot.html#cb27-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Edad de salida&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Densidad&quot;</span>, </span>
<span id="cb27-4"><a href="ggplot.html#cb27-4" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;1000 casos simulados de edad de primer salida educativa&quot;</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="talleR_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Construyamos el diagrama de Lexis de esta cohorte utilizando <code>LexisPlotR</code>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="ggplot.html#cb29-1" tabindex="-1"></a><span class="co"># una forma de moverse en el tiempo: a una fecha restarle cantidad de días</span></span>
<span id="cb29-2"><a href="ggplot.html#cb29-2" tabindex="-1"></a>clase<span class="sc">$</span>nacimiento  <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2000-03-03&quot;</span>) <span class="sc">-</span> clase<span class="sc">$</span>edad_inicio <span class="sc">*</span> <span class="fl">365.25</span></span>
<span id="cb29-3"><a href="ggplot.html#cb29-3" tabindex="-1"></a>clase<span class="sc">$</span>salida      <span class="ot">&lt;-</span> clase<span class="sc">$</span>nacimiento <span class="sc">+</span> clase<span class="sc">$</span>tiempo_exp <span class="sc">*</span> <span class="fl">365.25</span></span>
<span id="cb29-4"><a href="ggplot.html#cb29-4" tabindex="-1"></a></span>
<span id="cb29-5"><a href="ggplot.html#cb29-5" tabindex="-1"></a><span class="co"># creo Lexis</span></span>
<span id="cb29-6"><a href="ggplot.html#cb29-6" tabindex="-1"></a>mylexis     <span class="ot">&lt;-</span> <span class="fu">lexis_grid</span>(<span class="at">year_start =</span> <span class="dv">2000</span>, <span class="at">year_end =</span> <span class="dv">2025</span>, <span class="at">age_start =</span> <span class="dv">3</span>, <span class="at">age_end =</span> <span class="dv">30</span>)</span>
<span id="cb29-7"><a href="ggplot.html#cb29-7" tabindex="-1"></a>mylexis     <span class="ot">&lt;-</span> <span class="fu">lexis_lifeline</span>(<span class="at">lg =</span> mylexis, </span>
<span id="cb29-8"><a href="ggplot.html#cb29-8" tabindex="-1"></a>                          <span class="at">birth =</span> clase<span class="sc">$</span>nacimiento, </span>
<span id="cb29-9"><a href="ggplot.html#cb29-9" tabindex="-1"></a>                          <span class="at">entry =</span> <span class="st">&quot;2000-03-03&quot;</span>, </span>
<span id="cb29-10"><a href="ggplot.html#cb29-10" tabindex="-1"></a>                          <span class="at">exit =</span> clase<span class="sc">$</span>salida, <span class="at">lineends =</span> T,</span>
<span id="cb29-11"><a href="ggplot.html#cb29-11" tabindex="-1"></a>                          <span class="at">colour =</span> <span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb29-12"><a href="ggplot.html#cb29-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb29-13"><a href="ggplot.html#cb29-13" tabindex="-1"></a>mylexis</span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>¿Por qué las líneas no empiezan justo en 2000? Estimemos algunos parámetros básicos:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="ggplot.html#cb30-1" tabindex="-1"></a><span class="co"># la edad media de salida</span></span>
<span id="cb30-2"><a href="ggplot.html#cb30-2" tabindex="-1"></a><span class="fu">mean</span>(clase<span class="sc">$</span>edad_salida)</span>
<span id="cb30-3"><a href="ggplot.html#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a href="ggplot.html#cb30-4" tabindex="-1"></a><span class="co"># la probablidad de &quot;sobrevivir&quot; a la edad 18</span></span>
<span id="cb30-5"><a href="ggplot.html#cb30-5" tabindex="-1"></a>clase <span class="sc">%&gt;%</span> <span class="fu">filter</span>(edad_salida <span class="sc">&gt;=</span> <span class="dv">18</span>) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">n</span>()<span class="sc">/</span><span class="fu">nrow</span>(clase)) </span>
<span id="cb30-6"><a href="ggplot.html#cb30-6" tabindex="-1"></a></span>
<span id="cb30-7"><a href="ggplot.html#cb30-7" tabindex="-1"></a><span class="co"># probablidad de abandonar en los 20 años cumplidos </span></span>
<span id="cb30-8"><a href="ggplot.html#cb30-8" tabindex="-1"></a>clase <span class="sc">%&gt;%</span> <span class="fu">filter</span>(edad_salida <span class="sc">&gt;=</span> <span class="dv">20</span> <span class="sc">&amp;</span> edad_salida <span class="sc">&lt;</span> <span class="dv">21</span>) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">n</span>()<span class="sc">/</span><span class="fu">nrow</span>(clase))</span></code></pre></div>
<pre><code>## [1] 23.4662
##   n()/nrow(clase)
## 1           0.974
##   n()/nrow(clase)
## 1           0.103</code></pre>
<div id="actividad-8" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Actividad<a href="ggplot.html#actividad-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: lower-alpha">
<li><p>Crear un diagrama de Lexis e incluir en rojo las líneas de vida de las 3 personas más jóvenes que conozcas.</p></li>
<li><p>Considerando el ejercicio de permanencia escolar:</p>
<ul>
<li><p>Calcula la probabilidad de “salir” luego de los 30 años?</p></li>
<li><p>Cambia la semilla del ejercicio previo (<code>set.seed()</code>) por cualquier entero que desees y repite el ejercicio. ¿Hay diferencias? ¿Por qué?</p></li>
</ul></li>
</ol>
</div>
</div>
<div id="reproduciendo" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Reproduciendo<a href="ggplot.html#reproduciendo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>El covid19 puso en primera plana el análisis demográfico, especialmente en el impacto que tuvo en <span class="math inline">\(e_0\)</span> ¿No te parece genial la figura 1 del paper <a href="https://academic.oup.com/ije/advance-article/doi/10.1093/ije/dyab207/6375510">Quantifying impacts of the COVID-19 pandemic through life-expectancy losses: a population-level study of 29 countries</a> de Aburto y Otros (2021)? Podemos recrearlo gracias a que los autores lo permiten <a href="https://github.com/OxfordDemSci/ex2020/blob/master/src/08-plots.R">aquí</a>, haciendo su paper reproducible. De paso vamos viendo funciones nuevas. Iremos comentando los pasos:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="ggplot.html#cb32-1" tabindex="-1"></a><span class="co"># necesitamos algunas librerías que no tenemos aún. Si no las tenés debes instalarlas primero</span></span>
<span id="cb32-2"><a href="ggplot.html#cb32-2" tabindex="-1"></a><span class="co">#install.packages(&quot;hrbrthemes&quot;)</span></span>
<span id="cb32-3"><a href="ggplot.html#cb32-3" tabindex="-1"></a><span class="fu">library</span>(hrbrthemes)</span></code></pre></div>
<pre><code>## NOTE: Either Arial Narrow or Roboto Condensed fonts are required to use these themes.</code></pre>
<pre><code>##       Please use hrbrthemes::import_roboto_condensed() to install Roboto Condensed and</code></pre>
<pre><code>##       if Arial Narrow is not on your system, please see https://bit.ly/arialnarrow</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="ggplot.html#cb36-1" tabindex="-1"></a><span class="co"># cargar la data</span></span>
<span id="cb36-2"><a href="ggplot.html#cb36-2" tabindex="-1"></a></span>
<span id="cb36-3"><a href="ggplot.html#cb36-3" tabindex="-1"></a>df_ex_ci <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;Data/df_ex_ci.rds&quot;</span>)</span>
<span id="cb36-4"><a href="ggplot.html#cb36-4" tabindex="-1"></a><span class="fu">head</span>(df_ex_ci)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 19
##   code  sex     year   age    ex ex_diff ex_diff_1519 ex_2015 ex_2019 ex_2020
##   &lt;chr&gt; &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 AT    Female  2020     0  83.6  -0.671        0.490    83.8    84.3    83.6
## 2 AT    Female  2020     1  82.8  -0.650        0.447    83.0    83.4    82.8
## 3 AT    Female  2020     2  81.8  -0.648        0.439    82.0    82.5    81.8
## 4 AT    Female  2020     3  80.9  -0.652        0.442    81.1    81.5    80.9
## 5 AT    Female  2020     4  79.9  -0.657        0.449    80.1    80.5    79.9
## 6 AT    Female  2020     5  78.9  -0.662        0.455    79.1    79.6    78.9
## # ℹ 9 more variables: name &lt;fct&gt;, code_hmd &lt;chr&gt;, rank_e0f19 &lt;int&gt;,
## #   rank_d0m20 &lt;int&gt;, ex_diff_1920_q025 &lt;dbl&gt;, ex_diff_1920_q975 &lt;dbl&gt;,
## #   ex_avgdiff_pre2020 &lt;dbl&gt;, ex_avgdiff_pre2020_q025 &lt;dbl&gt;,
## #   ex_avgdiff_pre2020_q975 &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="ggplot.html#cb38-1" tabindex="-1"></a><span class="co"># crear el gráfico</span></span>
<span id="cb38-2"><a href="ggplot.html#cb38-2" tabindex="-1"></a>fig_1 <span class="ot">&lt;-</span> df_ex_ci <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="ggplot.html#cb38-3" tabindex="-1"></a>  <span class="co"># primero factorizar según el número actual de la variable</span></span>
<span id="cb38-4"><a href="ggplot.html#cb38-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> name <span class="sc">%&gt;%</span> <span class="fu">fct_reorder</span>(rank_e0f19)) <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="ggplot.html#cb38-5" tabindex="-1"></a>  <span class="co"># me interesa ciertas edades</span></span>
<span id="cb38-6"><a href="ggplot.html#cb38-6" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb38-7"><a href="ggplot.html#cb38-7" tabindex="-1"></a>  <span class="co"># si hay alguna NA sacar la fila</span></span>
<span id="cb38-8"><a href="ggplot.html#cb38-8" tabindex="-1"></a>  <span class="fu">drop_na</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="ggplot.html#cb38-9" tabindex="-1"></a>  <span class="co"># una forma de seleccionar</span></span>
<span id="cb38-10"><a href="ggplot.html#cb38-10" tabindex="-1"></a>  <span class="fu">transmute</span>(name, sex, age,ex_2015, ex_2019, <span class="at">ex_2020 =</span> ex) <span class="sc">%&gt;%</span></span>
<span id="cb38-11"><a href="ggplot.html#cb38-11" tabindex="-1"></a>  <span class="co"># hete aquí un pivot...</span></span>
<span id="cb38-12"><a href="ggplot.html#cb38-12" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> ex_2015<span class="sc">:</span>ex_2020,</span>
<span id="cb38-13"><a href="ggplot.html#cb38-13" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;ex&quot;</span>, <span class="at">names_prefix =</span> <span class="st">&quot;ex_&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-14"><a href="ggplot.html#cb38-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> age <span class="sc">%&gt;%</span> <span class="fu">as_factor</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb38-15"><a href="ggplot.html#cb38-15" tabindex="-1"></a>  <span class="co"># ggplot</span></span>
<span id="cb38-16"><a href="ggplot.html#cb38-16" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb38-17"><a href="ggplot.html#cb38-17" tabindex="-1"></a>  <span class="co"># un color por sexo, una forma por año</span></span>
<span id="cb38-18"><a href="ggplot.html#cb38-18" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> ex, <span class="at">y =</span> name, <span class="at">color =</span> sex, <span class="at">shape =</span> year))<span class="sc">+</span></span>
<span id="cb38-19"><a href="ggplot.html#cb38-19" tabindex="-1"></a>  <span class="co"># separar un poco con líneas grises</span></span>
<span id="cb38-20"><a href="ggplot.html#cb38-20" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">28</span>, <span class="dv">2</span>), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;#eaeaea&quot;</span>)<span class="sc">+</span></span>
<span id="cb38-21"><a href="ggplot.html#cb38-21" tabindex="-1"></a>  <span class="co"># personalizar qué formas, tamaños y colores usar</span></span>
<span id="cb38-22"><a href="ggplot.html#cb38-22" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">124</span>, <span class="dv">43</span>, <span class="dv">16</span>))<span class="sc">+</span></span>
<span id="cb38-23"><a href="ggplot.html#cb38-23" tabindex="-1"></a>  <span class="fu">scale_size_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">1.5</span>))<span class="sc">+</span></span>
<span id="cb38-24"><a href="ggplot.html#cb38-24" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#B5223BFF&quot;</span>, <span class="st">&quot;#64B6EEFF&quot;</span>))<span class="sc">+</span></span>
<span id="cb38-25"><a href="ggplot.html#cb38-25" tabindex="-1"></a>  <span class="co"># donde colocar los nombres de los ejes</span></span>
<span id="cb38-26"><a href="ggplot.html#cb38-26" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">position =</span> <span class="st">&quot;right&quot;</span>)<span class="sc">+</span></span>
<span id="cb38-27"><a href="ggplot.html#cb38-27" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">position =</span> <span class="st">&quot;top&quot;</span>)<span class="sc">+</span></span>
<span id="cb38-28"><a href="ggplot.html#cb38-28" tabindex="-1"></a>  <span class="co"># facet por edad, sin respetar escala</span></span>
<span id="cb38-29"><a href="ggplot.html#cb38-29" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>age, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)<span class="sc">+</span></span>
<span id="cb38-30"><a href="ggplot.html#cb38-30" tabindex="-1"></a>  <span class="co"># sin leyenda, líneas horizonatales y demases</span></span>
<span id="cb38-31"><a href="ggplot.html#cb38-31" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-32"><a href="ggplot.html#cb38-32" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb38-33"><a href="ggplot.html#cb38-33" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-34"><a href="ggplot.html#cb38-34" tabindex="-1"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-35"><a href="ggplot.html#cb38-35" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-36"><a href="ggplot.html#cb38-36" tabindex="-1"></a>    <span class="at">panel.spacing.x =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb38-37"><a href="ggplot.html#cb38-37" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb38-38"><a href="ggplot.html#cb38-38" tabindex="-1"></a>  <span class="co"># etiquetas de ejes</span></span>
<span id="cb38-39"><a href="ggplot.html#cb38-39" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Life expectancy, years&quot;</span>,<span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb38-40"><a href="ggplot.html#cb38-40" tabindex="-1"></a></span>
<span id="cb38-41"><a href="ggplot.html#cb38-41" tabindex="-1"></a><span class="co"># guardar</span></span>
<span id="cb38-42"><a href="ggplot.html#cb38-42" tabindex="-1"></a><span class="fu">ggsave</span>(fig_1, <span class="at">filename =</span> <span class="st">&quot;fig-1.pdf&quot;</span>,</span>
<span id="cb38-43"><a href="ggplot.html#cb38-43" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="fl">4.5</span>, <span class="at">device =</span> cairo_pdf)</span></code></pre></div>
<p>Las etiquetas en referencia a la edad y la formas de los puntos las realizaron posteriormente con <a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a>, una función que permite incluir (encima) texto u otras figuras geométricas en el plano.</p>
</div>
<div id="otras-visualizaciones" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Otras visualizaciones<a href="ggplot.html#otras-visualizaciones" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Samuel Preston (1975) encontró una relación matemática (al menos) a nivel de país entre la esperanza de vida al nacer y el producto per cápita. Veamos que ocurre específicamente en el Continente Americano utilizando el paquete de datos <code>gapminder</code>.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="ggplot.html#cb39-1" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb39-2"><a href="ggplot.html#cb39-2" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">filter</span>(gapminder, continent <span class="sc">==</span> <span class="st">&quot;Americas&quot;</span>),</span>
<span id="cb39-3"><a href="ggplot.html#cb39-3" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y =</span> lifeExp))</span>
<span id="cb39-4"><a href="ggplot.html#cb39-4" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="co"># dispersión</span></span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="ggplot.html#cb40-1" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> country), <span class="at">alpha =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> F) </span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-34-2.png" width="672" /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="ggplot.html#cb41-1" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> country, <span class="at">size =</span> pop), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="co"># fijate el lugar de size </span></span>
<span id="cb41-2"><a href="ggplot.html#cb41-2" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> p1 <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="dv">2</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-3"><a href="ggplot.html#cb41-3" tabindex="-1"></a>p1</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
<p><img src="talleR_files/figure-html/unnamed-chunk-34-3.png" width="672" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="ggplot.html#cb43-1" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> country) <span class="sc">+</span></span>
<span id="cb43-2"><a href="ggplot.html#cb43-2" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb43-3"><a href="ggplot.html#cb43-3" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
<p><img src="talleR_files/figure-html/unnamed-chunk-34-4.png" width="672" /></p>
<p>¿Componer gráficos en una sola hoja? (tomado de <a href="https://stat545.com/">Jenny Bryan</a>)</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="ggplot.html#cb45-1" tabindex="-1"></a><span class="co">#install.packages(&quot;gridExtra&quot;)</span></span>
<span id="cb45-2"><a href="ggplot.html#cb45-2" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;gridExtra&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     combine</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="ggplot.html#cb48-1" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">filter</span>(gapminder, year<span class="sc">==</span><span class="dv">1952</span> <span class="sc">&amp;</span> continent<span class="sc">!=</span><span class="st">&quot;Oceania&quot;</span>), <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">color =</span> continent))       <span class="sc">+</span> <span class="fu">geom_density</span>()</span>
<span id="cb48-2"><a href="ggplot.html#cb48-2" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">filter</span>(gapminder, year<span class="sc">==</span><span class="dv">2007</span> <span class="sc">&amp;</span> continent<span class="sc">!=</span><span class="st">&quot;Oceania&quot;</span>), <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">color =</span> continent))       <span class="sc">+</span> <span class="fu">geom_density</span>()</span>
<span id="cb48-3"><a href="ggplot.html#cb48-3" tabindex="-1"></a><span class="fu">grid.arrange</span>(p2, p3, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="talleR_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>¿Qué problemas encuentras en este arreglo?</p>
</div>
<div id="material-adicional-y-no-tanto" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Material adicional (y no tanto)<a href="ggplot.html#material-adicional-y-no-tanto" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Sí, hay un <a href="https://ggplot2-book.org/index.html">libro</a>.</p></li>
<li><p>Estas notas fueron hechas siguiendo principalmente <a href="https://leanpub.com/hitchhikers_ggplot2">The Hitchhiker’s Guide to Ggplot2</a> y el curso de <a href="https://stat545.com/">Jenny Bryan</a>.<br />
</p></li>
<li><p><a href="https://github.com/rstudio/cheatsheets/blob/main/data-visualization-2.1.pdf">Hoja de Ayuda</a>.</p></li>
<li><p>Hulíková Tesárková &amp; Kurtinová. Application of “Lexis” Diagram: Contemporary Approach to Demographic Visualization and Selected Examples of Software Applications.</p></li>
<li><p>Rau, R., Bohk-Ewald, C., Muszyńska, M. M., &amp; Vaupel, J. W. (2018). Visualizing Mortality Dynamics in the Lexis Diagram. Springer. doi: 10.1007/978-3-319-64820-0</p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dplyr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="funciones.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/03-ggplot.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/rstudio/bookdown-demo/raw/master/03-ggplot.Rmd"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
